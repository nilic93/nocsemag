
service: functions

provider:
  name: aws
  runtime: nodejs12.x
  region: eu-central-1
  stage: ${opt:stage, 'dev'}
  # environment variables can be added here
  # environment:
custom:
  prune:
    ${file(templates/shared.yml):prune}
  webpack:
    ${file(templates/shared.yml):webpack}
  result-table-read-role:
    arn:aws:iam::#{AWS::AccountId}:role/ResultReadRole

functions:

  results:
    handler: src/functions/basic/results/handler.results
    role: ${self:custom.result-table-read-role}
    environment:
      RESULT_TABLE_NAME: result-${self:provider.stage}
    events:
      - http:
          method: get
          path: results
          cors: true

  get-user-result:
    handler: src/functions/basic/get-user-result/handler.getUserResult
    role: ${self:custom.result-table-read-role}
    environment:
      RESULT_TABLE_NAME: result-${self:provider.stage}
    events:
      - http:
          method: get
          path: user
          cors: true
          authorizer:
            type: COGNITO_USER_POOLS
            authorizerId:
              Ref: ApiGatewayAuthorizer

  put-result:
    handler: src/functions/basic/put_result/handler.putResult
    events:
      - http:
          method: post
          path: result
          cors: true
          authorizer:
            type: COGNITO_USER_POOLS
            authorizerId:
              Ref: ApiGatewayAuthorizer

# resources can be added here
resources:
  ${file(templates/shared.yml):authorizer}

plugins:
  - serverless-pseudo-parameters
  - serverless-webpack
  - serverless-prune-plugin



