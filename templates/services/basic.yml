
service: functions

provider:
  name: aws
  runtime: nodejs12.x
  region: eu-central-1
  stage: ${opt:stage, 'dev'}
  # environment variables can be added here
  # environment:
custom:
  prune:
    ${file(templates/shared.yml):prune}
  webpack:
    ${file(templates/shared.yml):webpack}
  result-table-read-role:
    arn:aws:iam::#{AWS::AccountId}:role/ResultReadRole

functions:

  translations:
    handler: src/functions/basic/translations/handler.translations
    role: ${self:custom.result-table-read-role}
    environment:
      RESULT_TABLE_NAME: result-base
    events:
      - http:
          method: get
          path: translations
          cors: true

  slides:
    handler: src/functions/basic/slides/handler.slides
    role: ${self:custom.result-table-read-role}
    environment:
      RESULT_TABLE_NAME: result-base
    events:
      - http:
          method: get
          path: slides
          cors: true
          authorizer:
            type: COGNITO_USER_POOLS
            authorizerId:
              Ref: ApiGatewayAuthorizer

  init:
    handler: src/functions/basic/init/handler.init
    events:
      - http:
          method: post
          path: init
          cors: true
          authorizer:
            type: COGNITO_USER_POOLS
            authorizerId:
              Ref: ApiGatewayAuthorizer

# resources can be added here
resources:
  ${file(templates/shared.yml):authorizer}

plugins:
  - serverless-pseudo-parameters
  - serverless-webpack
  - serverless-prune-plugin



